import{c as ct,g as lt,d as D,m as dt,r as d,b as pt,j as t,f as ut,i as xt,y as ht,u as A,o as gt}from"./index-D5DSkeF1.js";import{T as mt,g as U,B as G,C as ft,b as yt,F as jt,c as J}from"./ButtonFillIcon-DDLw4Zhr.js";import{A as Ct,C as bt,O as wt,g as vt,B as X,a as _t,c as St,b as Tt}from"./bucket-CmRTTGm0.js";import{d as Et,u as It,a as h,G as H,T as p,b as kt,I as zt}from"./GlobeIcon-5fnF1emq.js";import{c as Wt,C as Rt,a as K}from"./axios-Br-_n-tZ.js";import{u as Ot}from"./Paper-jPBVfpNG.js";import"./index-BYh-8Bfw.js";import"./Button-NBn3Bk9O.js";function Bt(e){return lt("MuiCollapse",e)}ct("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const Mt=e=>{const{orientation:s,classes:n}=e,i={root:["root",`${s}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${s}`],wrapperInner:["wrapperInner",`${s}`]};return xt(i,Bt,n)},Lt=D("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:n}=e;return[s.root,s[n.orientation],n.state==="entered"&&s.entered,n.state==="exited"&&!n.in&&n.collapsedSize==="0px"&&s.hidden]}})(dt(({theme:e})=>({height:0,overflow:"hidden",transition:e.transitions.create("height"),variants:[{props:{orientation:"horizontal"},style:{height:"auto",width:0,transition:e.transitions.create("width")}},{props:{state:"entered"},style:{height:"auto",overflow:"visible"}},{props:{state:"entered",orientation:"horizontal"},style:{width:"auto"}},{props:({ownerState:s})=>s.state==="exited"&&!s.in&&s.collapsedSize==="0px",style:{visibility:"hidden"}}]}))),Dt=D("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(e,s)=>s.wrapper})({display:"flex",width:"100%",variants:[{props:{orientation:"horizontal"},style:{width:"auto",height:"100%"}}]}),$t=D("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(e,s)=>s.wrapperInner})({width:"100%",variants:[{props:{orientation:"horizontal"},style:{width:"auto",height:"100%"}}]}),F=d.forwardRef(function(s,n){const i=pt({props:s,name:"MuiCollapse"}),{addEndListener:r,children:l,className:x,collapsedSize:a="0px",component:c,easing:u,in:f,onEnter:y,onEntered:k,onEntering:z,onExit:g,onExited:w,onExiting:W,orientation:R="vertical",style:_,timeout:C=ht.standard,TransitionComponent:Q=mt,...V}=i,O={...i,orientation:R,collapsedSize:a},S=Mt(O),P=Ot(),Z=Et(),b=d.useRef(null),$=d.useRef(),B=typeof a=="number"?`${a}px`:a,T=R==="horizontal",E=T?"width":"height",M=d.useRef(null),tt=It(n,M),v=o=>m=>{if(o){const j=M.current;m===void 0?o(j):o(j,m)}},N=()=>b.current?b.current[T?"clientWidth":"clientHeight"]:0,et=v((o,m)=>{b.current&&T&&(b.current.style.position="absolute"),o.style[E]=B,y&&y(o,m)}),st=v((o,m)=>{const j=N();b.current&&T&&(b.current.style.position="");const{duration:I,easing:L}=U({style:_,timeout:C,easing:u},{mode:"enter"});if(C==="auto"){const q=P.transitions.getAutoHeightDuration(j);o.style.transitionDuration=`${q}ms`,$.current=q}else o.style.transitionDuration=typeof I=="string"?I:`${I}ms`;o.style[E]=`${j}px`,o.style.transitionTimingFunction=L,z&&z(o,m)}),nt=v((o,m)=>{o.style[E]="auto",k&&k(o,m)}),ot=v(o=>{o.style[E]=`${N()}px`,g&&g(o)}),it=v(w),at=v(o=>{const m=N(),{duration:j,easing:I}=U({style:_,timeout:C,easing:u},{mode:"exit"});if(C==="auto"){const L=P.transitions.getAutoHeightDuration(m);o.style.transitionDuration=`${L}ms`,$.current=L}else o.style.transitionDuration=typeof j=="string"?j:`${j}ms`;o.style[E]=B,o.style.transitionTimingFunction=I,W&&W(o)}),rt=o=>{C==="auto"&&Z.start($.current||0,o),r&&r(M.current,o)};return t.jsx(Q,{in:f,onEnter:et,onEntered:nt,onEntering:st,onExit:ot,onExited:it,onExiting:at,addEndListener:rt,nodeRef:M,timeout:C==="auto"?null:C,...V,children:(o,m)=>t.jsx(Lt,{as:c,className:ut(S.root,x,{entered:S.entered,exited:!f&&B==="0px"&&S.hidden}[o]),style:{[T?"minWidth":"minHeight"]:B,..._},ref:tt,...m,ownerState:{...O,state:o},children:t.jsx(Dt,{ownerState:{...O,state:o},className:S.wrapper,ref:b,children:t.jsx($t,{ownerState:{...O,state:o},className:S.wrapperInner,children:l})})})})});F&&(F.muiSupportAuto=!0);const Nt=()=>{const e=A(),s=gt();return t.jsx(h,{display:"grid",gap:8,mb:6,children:t.jsxs(H,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[t.jsx(G,{onClick:()=>s(-1),children:t.jsx(Ct,{sx:{color:e.palette.white,fontSize:"28px"}})}),t.jsx(p,{variant:"h1",textTransform:"uppercase",color:e.palette.primary.contrastText,children:"Navat"}),t.jsx(G,{children:t.jsx(kt,{width:28,height:28,color:e.palette.white})})]})})},Ft=({color:e,totalCost:s,name:n,avatar:i})=>t.jsxs(H,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[t.jsx(h,{sx:{bgcolor:e,width:"44px",aspectRatio:"1/1",borderRadius:"100%",display:"grid",placeContent:"center"},children:t.jsx("img",{src:i||"",alt:"animal",style:{width:"40px",aspectRatio:"1/1"}})}),t.jsx(p,{variant:"h1",mr:"auto",ml:3,fontWeight:600,children:n||"Корзина"}),t.jsx(p,{variant:"h1",fontWeight:600,children:s&&`${s} c`})]}),At=Wt(t.jsx("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),Ht=({item:e,showCounter:s,handleChangeCount:n,...i})=>{const r=A(),[l,x]=d.useState(!1),[a,c]=d.useState(e.count),[u,f]=d.useState(e.discount_cost),y=g=>{const w=z(g);f(w),c(g),n&&n({[e._id]:g,totalCost:w})},k=()=>{x(!l)},z=g=>{const w=Number(e.options.cost),W=e.modifiers.reduce((R,_)=>R+Number(_.additional_cost),0);return(w+W)*(g||a)};return t.jsxs(Rt,{sx:{borderRadius:"8px",boxShadow:" 0px 1px 10px 0px #00000033",display:"flex",alignItems:"start"},...i,children:[t.jsx(ft,{component:"img",sx:{height:"62px",width:"80px",borderRadius:"12px",marginX:"16px",mt:"16px"},image:e.image_url,alt:"Live from space album cover"}),t.jsxs(K,{sx:{display:"flex",flexDirection:"column",height:"100%",width:"100%",padding:"16px !important",paddingLeft:"0px !important"},children:[t.jsx(p,{variant:"h5",height:"18px",mb:2,sx:{width:"100%",overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:1},children:e.name}),t.jsxs(p,{variant:"body1",mb:2,pt:1,sx:{color:r.palette.secondary.contrastText,width:"100%",overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,position:"relative",pr:8},children:[e.description,e.modifiers.length&&t.jsx(Pt,{expand:l,onClick:k,"aria-expanded":l,"aria-label":"show more",sx:{position:"absolute",bottom:-4,right:0},children:t.jsx(At,{})})]}),t.jsx(F,{in:l,timeout:"auto",unmountOnExit:!0,children:t.jsxs(K,{sx:{p:0},children:[t.jsxs(h,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[t.jsxs(p,{variant:"body1",color:r.palette.secondary.contrastText,mb:2,children:["Опции: ",t.jsx("b",{children:e.options.option_name})]}),t.jsxs(p,{variant:"body1",color:r.palette.secondary.contrastText,mb:2,children:[e.options.cost," с"]})]}),t.jsxs(h,{sx:{display:"flex"},children:[t.jsx(p,{variant:"body1",color:r.palette.secondary.contrastText,children:"Добавки:"}),t.jsx("ul",{style:{margin:0,paddingLeft:"16px",width:"100%"},children:e.modifiers.map(g=>t.jsx("li",{children:t.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(p,{variant:"body1",fontWeight:700,color:r.palette.secondary.contrastText,children:g.name}),t.jsxs(p,{variant:"body1",color:r.palette.secondary.contrastText,children:[g.additional_cost," с"]})]})},g.id))})]})]})}),t.jsxs(h,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[t.jsx(H,{children:s?t.jsx(bt,{count:a,setCount:y,size:8}):t.jsxs(p,{variant:"body2",color:r.palette.secondary.contrastText,fontWeight:700,children:["Количество: ",a]})}),t.jsxs(p,{variant:"h5",display:"flex",align:"center",gap:1,children:[t.jsx(p,{fontWeight:700,children:"Итог:"})," ",u," с"]})]})]})]})},Pt=D(e=>{const{expand:s,...n}=e;return t.jsx(zt,{...n})})(({theme:e})=>({marginLeft:"auto",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),variants:[{props:({expand:s})=>!s,style:{transform:"rotate(0deg)"}},{props:({expand:s})=>!!s,style:{transform:"rotate(180deg)"}}]})),Y=({list:e,avatar:s,color:n,showCounter:i,name:r,handleChangeCount:l})=>{const x=()=>e==null?void 0:e.items.reduce((a,c)=>a+c.discount_cost,0);return t.jsx(wt,{color:n,children:t.jsxs(h,{display:"grid",gap:4,children:[e&&t.jsx(Ft,{totalCost:i?void 0:x(),color:n,name:r,avatar:s}),e&&e.items.map((a,c)=>t.jsx("div",{children:t.jsx(Ht,{handleChangeCount:l,showCounter:i,item:a,color:n})},c))]})})},qt=()=>{const[e,s]=d.useState(!1),[n,i]=d.useState({}),r=async()=>{s(!0);const l=localStorage.getItem("access"),x=localStorage.getItem("client_id");try{const a=await vt({qr_code_id:l||"",client_id:x||""});a.status===200&&i(a.data)}catch(a){console.log(a)}s(!1)};return d.useEffect(()=>{r()},[]),{data:n,setData:i,isLoading:e,setIsLoading:s,fetchBucket:r}},Ut=()=>{const[e,s]=d.useState([]),[n,i]=d.useState(null);return d.useEffect(()=>{const l=new WebSocket("wss://n099vfqg37.execute-api.eu-north-1.amazonaws.com/production/");return i(l),l.onopen=()=>{console.log("Connected to WebSocket")},l.onmessage=x=>{s(a=>[...a,x.data])},()=>{l.close()}},[]),{messages:e,sendMessage:l=>{n&&n.send(JSON.stringify({action:"sendmessage",message:JSON.stringify(l)}))}}},Gt=()=>{const{sendMessage:e}=Ut(),{data:s,fetchBucket:n}=qt(),[i,r]=d.useState([]);d.useEffect(()=>{s.client_items&&s.client_items.bucket&&r(s.client_items.bucket.items.map(c=>({[c._id]:c.count,totalCost:c.discount_cost})))},[s]);const l=c=>{r(u=>{const f=u.findIndex(y=>Object.keys(y)[0]===Object.keys(c)[0]);return f!==-1?[...u.slice(0,f),c,...u.slice(f+1,u.length)]:[...u,c]})},x=async()=>{try{const c=localStorage.getItem("access"),u=localStorage.getItem("client_id");(await St({qr_code_id:c||"",client_id:u||"",body:i.map(y=>({[Object.keys(y)[0]]:Object.values(y)[0]}))})).status===200&&(e(c||""),await n())}catch(c){console.log(c)}},a=d.useMemo(()=>i.reduce((c,u)=>c+u.totalCost,0),[i]);return t.jsxs(h,{sx:{display:"grid",gap:3},children:[s.client_items&&t.jsx(Y,{handleChangeCount:l,showCounter:!0,list:s.client_items.bucket,color:s.client_items.client.color,name:s.client_items.client.name,avatar:s.client_items.client.avatar}),t.jsx(X,{children:t.jsxs(h,{display:"flex",alignItems:"center",justifyContent:"space-between",gap:3,children:[t.jsx(p,{variant:"h3",fontWeight:600,textAlign:"center",flex:1,children:`${a} c`}),t.jsx(h,{sx:{width:"260px"},children:t.jsx(_t,{fullWidth:!0,onClick:x,children:"Add to card"})})]})})]})},Jt=()=>{const[e,s]=d.useState(!1),[n,i]=d.useState({}),r=async()=>{s(!0);const l=localStorage.getItem("access"),x=localStorage.getItem("client_id");try{const a=await Tt({qr_code_id:l||"",client_id:x||""});a.status===200&&i(a.data)}catch(a){console.log(a)}s(!1)};return d.useEffect(()=>{r()},[]),{data:n,setData:i,isLoading:e,setIsLoading:s,fetchConfirmed:r}},Kt=()=>{const{data:e}=Jt(),s=A();return t.jsxs(h,{sx:{display:"grid",gap:3},children:[e.client_items&&e.client_items.confirmed.map((n,i)=>t.jsx(Y,{list:{items:n.confirmed.items,total_original_cost:n.total.total_original_cost,total_discount_cost:n.total.total_discount_cost},color:n.client.color,showCounter:!1,avatar:n.client.avatar,name:n.client.name},i)),t.jsx(X,{bgColor:s.palette.primary.main,children:t.jsx(h,{display:"flex",alignItems:"center",justifyContent:"center",children:t.jsxs(p,{color:s.palette.white,variant:"h2",paddingY:"10px",children:["Общая сумма: ",e.total_bill||"0"," с"]})})})]})},Xt=["Корзина","Мой стол"],oe=()=>{const[e,s]=d.useState("0"),n=(i,r)=>{s(r.toString())};return t.jsxs(h,{paddingBottom:18,children:[t.jsx(Nt,{}),t.jsxs(yt,{value:e,children:[t.jsx(jt,{order:!0,value:+e,tabList:Xt,onChange:n}),t.jsx(J,{value:"0",children:t.jsx(Gt,{})}),t.jsx(J,{value:"1",children:t.jsx(Kt,{})})]})]})};export{oe as default};
